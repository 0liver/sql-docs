<#https://techcommunity.microsoft.com/t5/itops-talk-blog/powershell-basics-how-to-create-an-azure-ad-app-registration/ba-p/811570#

This PowerShell Script will setup an Azure Active Directory Application / Registration
OUTPUT: The Application(Client)ID and Secret that will be needed for TSQL Configuration

#>

<# Install-Module AzureAD #>

$TenantId = "72f988bf-86f1-41af-91ab-2d7cd011db47"
$appName = "SQLConnectorDemo4"
$appNameApp = $appName + "App"
$appURI = "https://$appNameApp.$appName.onmicrosoft.com"
$appHomePageUrl = "http://www.$appName.com/"
$appReplyURLs = @($appURI, $appHomePageURL, "https://localhost:1234")

Connect-AzureAD -TenantId $TenantId -AzureEnvironmentName AzureCloud

if(!($myApp = Get-AzureADApplication -Filter "DisplayName eq '$($appName)'"  -ErrorAction SilentlyContinue))
{
    $myApp = New-AzureADApplication -DisplayName $appName -IdentifierUris $appURI -Homepage $appHomePageUrl -ReplyUrls $appReplyURLs    
}


$Secret = "$((New-AzureADApplicationPasswordCredential -ObjectId "$((Get-AzureADApplication -Filter "DisplayName eq '$appName'").ObjectId)" -CustomKeyIdentifier $appNameKey ).Value)"
$ObjId = "$((Get-AzureADApplication -Filter "DisplayName eq '$appName'").ObjectId)"
$AppId = "$((Get-AzureADApplication -Filter "DisplayName eq '$appName'").AppId)"
$AppSecret = ("$AppId").Replace("-", "") + $Secret

<# Get-AzureADApplicationPasswordCredential -ObjectId $ObjId -OutVariable Value #>
Write-Host "AppId   : " $AppId
Write-Host "ObjectId: " $ObjId
Write-Host "Value   : " $Secret

Write-Host "SQLSecret: " $AppSecret

"AppId    : " + $AppId + "
Value    : " + $Secret + "
SQLSecret: " + $AppSecret | Out-File -FilePath c:\Temp\$appName.txt