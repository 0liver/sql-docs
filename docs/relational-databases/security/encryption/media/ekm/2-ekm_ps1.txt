<# This PowerShell script will:
   1) Connect to Azure using your Azure Account
   2) Switch to the subscription of choice
   3) Create an ew Resource Group (to be a container for the Key Vault)
   4) Generate a new Azure Key Vault
   5) Gran the appropriate Access to the Key Vault
   6) Validate the Key Vault was created
   7) Add a Key to the Key Vault

#>
$AzureSubscription    = "YourAzureSubscription"
$RGName               = 'ContosoDevRG'
$Location             = 'East Asia'
$VaultName            = 'ContosoEKMKeyVault'
$VaultKeyName         = 'ContosoRSAKey0'
$ServicePrincipalName = '9a57cbc5-4c4c-40e2-b517-ea677e0efa00' <# This is the App (Client) ID from Azure Active Directory #>
<# ContosoKeyVaultEKMSecret "08:k?[:XEZFxcwIPvVVZhTjHWXm7w1?m" #>

<#Step 1#> Connect-AzAccount 

<#Step 2#> Select-AzSubscription $AzureSubscription 
 
<#Step 3#> New-AzResourceGroup -Name $RGName -Location $Location 

<#Step 4#> New-AzKeyVault -VaultName $VaultName -ResourceGroupName $RGName -Location $Location

<#Step 5#> Set-AzKeyVaultAccessPolicy -VaultName $VaultName -ServicePrincipalName $ServicePrincipalName -PermissionsToKeys get, wrapKey, unwrapKey, list 

<#Step 6#> Get-AzKeyVault -VaultName $VaultName

<#Step 7#> Add-AzKeyVaultKey -VaultName $VaultName -Name $VaultKeyName -Destination 'Software'
